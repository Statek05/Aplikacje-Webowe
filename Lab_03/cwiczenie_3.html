<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ćwiczenie 3: Dane z API</title>
  </head>
  <body>
    <h2>Produkty z API</h2>

    <div>
      <input type="text" id="filterInput" placeholder="Filtruj po tytule..." />
      <select id="sortSelect">
        <option value="original">Oryginalna kolejność</option>
        <option value="asc">Rosnąco (A-Z)</option>
        <option value="desc">Malejąco (Z-A)</option>
      </select>
    </div>

    <table border="1">
      <thead>
        <tr>
          <th>Zdjęcie</th>
          <th>Tytuł</th>
          <th>Opis</th>
        </tr>
      </thead>
      <tbody id="productsTableBody"></tbody>
    </table>

    <script>
      let allProducts = [];
      let displayedProducts = [];

      async function fetchProducts() {
        try {
          const response = await fetch("https://dummyjson.com/products");
          const data = await response.json();

          allProducts = data.products.slice(0, 30);
          displayedProducts = [...allProducts];
          renderTable(displayedProducts);
        } catch (error) {
          console.error("Błąd pobierania danych:", error);
        }
      }

      function renderTable(products) {
        const tbody = document.getElementById("productsTableBody");
        tbody.innerHTML = "";

        products.forEach((product) => {
          const tr = document.createElement("tr");

          const tdImg = document.createElement("td");
          const img = document.createElement("img");
          img.src = product.thumbnail;
          img.alt = product.title;
          img.width = 100; // Dodane tylko dla czytelności obrazka
          tdImg.appendChild(img);

          const tdTitle = document.createElement("td");
          tdTitle.textContent = product.title;

          const tdDesc = document.createElement("td");
          tdDesc.textContent = product.description;

          tr.appendChild(tdImg);
          tr.appendChild(tdTitle);
          tr.appendChild(tdDesc);
          tbody.appendChild(tr);
        });
      }

      document.getElementById("filterInput").addEventListener("input", (e) => {
        const phrase = e.target.value.toLowerCase();
        displayedProducts = allProducts.filter(
          (p) =>
            p.title.toLowerCase().includes(phrase) ||
            p.description.toLowerCase().includes(phrase)
        );
        applySort();
      });

      document.getElementById("sortSelect").addEventListener("change", () => {
        applySort();
      });

      function applySort() {
        const sortValue = document.getElementById("sortSelect").value;
        let sorted = [...displayedProducts];

        if (sortValue === "asc") {
          sorted.sort((a, b) => a.title.localeCompare(b.title));
        } else if (sortValue === "desc") {
          sorted.sort((a, b) => b.title.localeCompare(a.title));
        } else if (sortValue === "original") {
          const phrase = document
            .getElementById("filterInput")
            .value.toLowerCase();
          sorted = allProducts.filter(
            (p) =>
              p.title.toLowerCase().includes(phrase) ||
              p.description.toLowerCase().includes(phrase)
          );
        }

        renderTable(sorted);
      }

      fetchProducts();
    </script>
  </body>
</html>
